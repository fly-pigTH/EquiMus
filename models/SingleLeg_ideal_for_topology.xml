<!-- Ideal single-leg rod-ball model -->

<mujoco model="v2_4">
    <compiler angle="radian"/>
    <option timestep="0.001" iterations="2000" gravity="0 0 -9.8" tolerance="1e-10"/>
    
    <default>
        <geom density="418"/>
    </default>

    <asset>
        <texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3"
            rgb2=".2 .3 .4" width="300" height="300"/>
        <material name="grid" texture="grid" texrepeat="8 8" reflectance=".2"/>
    </asset>

    <worldbody>
        <light name="top" pos="0 0 5" diffuse="1 1 1" ambient="0.5 0.5 0.5"/>
        <camera name="closeup" pos="1.483 -0.033 0.580" xyaxes="0.040 0.999 -0.000 -0.129 0.005 0.992"/>

        <geom size="10 10 .01" type="plane" material="grid" friction="1 0.005 0.0001"/>

        <body name="Base" pos="0 0 0.8">
            <geom size="0.01 0.2 0.01" type="box" rgba="0.8 0 0 0.8" mass="0.155" contype="0" conaffinity="0"/>
            <body name="RB_Thigh" pos="0 0 0">
                <geom size="0.005" type="capsule" rgba="0.8 0 0 0.8" mass="0.086" fromto="0 0 0 0 0 -0.25" contype="0" conaffinity="0"/>
                <joint name="RB_Shoulder" type="hinge" axis="1 0 0" range="-1.57 1.57"/>
                <body name="RB_Calf" pos="0 0 -0.25">
                    <geom size="0.005" type="capsule" rgba="0.8 0 0 0.8" mass="0.1033" fromto="0 0 0 0 0 -0.25" contype="0" conaffinity="0"/>
                    <joint name="RB_Elbow" type="hinge" axis="1 0 0" range="-1.57 1.57"/>
                    <body name="Leg" pos="0 0 -0.25">
                        <geom size="0.005" type="capsule" rgba="0.8 0 0 0.8" mass="0.1033" fromto="0 0 0 0 0 -0.25" contype="0" conaffinity="0"/>
                        <joint name="Leg_joint" type="hinge" axis="1 0 0" range="-1.57 1.57"/>
                    </body>
                    <body name="Leg_RB_BAA_UPLink" pos="0 0.1 -0.1" axisangle="1 0 0 -0.1973955598">
                        <geom size="0.005" type="sphere" rgba="0.5 0.5 0 0.8" mass="0.03" contype="0" conaffinity="0"/>
                        <site name="Leg_RB_BAA_anchor1" pos="0 0 0"/>
                        <joint name="Leg_RB_BAA_UPJoint" type="hinge" axis="1 0 0"/>
                        <body name="Leg_RB_BAA_FMLink" pos="0 0 -0.1274754878">
                            <geom size="0.005" type="sphere" rgba="0.5 0.5 0 0.8" mass="0.12" contype="0" conaffinity="0"/>
                            <joint name="Leg_RB_BAA_SlideJoint" type="slide" axis="0 0 -1" damping="0" stiffness="0" springref="0"/>
                            <body name="Leg_RB_BAA_LOLink" pos="0 0 -0.1274754878">
                                <geom size="0.005" type="sphere" rgba="0.5 0.5 0 0.8" mass="0.03" contype="0" conaffinity="0"/>
                                <joint name="Leg_RB_BAA_FM_SlideJoint" type="slide" axis="0 0 -1" damping="0" stiffness="0" springref="0"/>
                                <site name="Leg_RB_BAA_anchor2" pos="0 0 0"/>
                            </body>
                        </body>
                    </body>
                </body>
               
            </body>
            <body name="RB_MAA_UPLink" pos="0 -0.06 0" axisangle="1 0 0 0.1419014548">
                <geom size="0.005" type="sphere" rgba="0.8 0 0 0.8" mass="0.03108" contype="0" conaffinity="0"/>
                <site name="RB_MAA_anchor1" pos="0 0 0"/>
                <joint name="RB_MAA_UpJoint" type="hinge" axis="1 0 0"/>
                <body name="RB_MAA_FM_Link" pos="0 0 -0.1060650937413537">
                    <geom size="0.005" type="sphere" rgba="0.8 0 0 0.8" mass="0.12432" contype="0" conaffinity="0"/>
                    <joint name="RB_MAA_SlideJoint" type="slide" axis="0 0 -1" damping="22.68" stiffness="637.52" springref="-0.019065093741353706"/>
                    <body name="RB_MAA_LOLink" pos="0 0 -0.1060650937413537">
                        <geom size="0.005" type="sphere" rgba="0.8 0 0 0.8" mass="0.03108" contype="0" conaffinity="0"/>
                        <joint name="RB_MAA_FM_SlideJoint" type="slide" axis="0 0 -1" damping="22.68" stiffness="637.52" springref="-0.019065093741353706"/>
                        <site name="RB_MAA_anchor2" pos="0 0 0"/>
                    </body>
                </body>
            </body>
            <body name="RB_BAA_UPLink" pos="0 0.1 0" axisangle="1 0 0 -0.147464847">
                <geom size="0.005" type="sphere" rgba="0 0 0.5 0.8" mass="0.04544333333" contype="0" conaffinity="0"/>
                <site name="RB_BAA_anchor1" pos="0 0 0"/>
                <joint name="RB_BAA_UpJoint" type="hinge" axis="1 0 0"/>
                <body name="RB_BAA_FM_LINK" pos="0 0 -0.17014792842496052">
                    <geom size="0.005" type="sphere" rgba="0 0 0.5 0.8" mass="0.1817733333" contype="0" conaffinity="0"/>
                    <joint name="RB_BAA_SlideJoint" type="slide" axis="0 0 -1" damping="21.8" stiffness="631.6" springref="-0.04204792842496052"/>
                    <body name="RB_BAA_LOLink" pos="0 0 -0.17014792842496052">
                        <geom size="0.005" type="sphere" rgba="0 0 0.5 0.8" mass="0.04544333333" contype="0" conaffinity="0"/>
                        <joint name="RB_BAA_FM_SlideJoint" type="slide" axis="0 0 -1" damping="21.8" stiffness="631.6" springref="-0.04204792842496052"/>
                        <site name="RB_BAA_anchor2" pos="0 0 0"/>
                    </body>
                </body>
            </body>
        </body>
        <!-- </body> -->

    </worldbody>

          <!-- Add 8 position controllers to joints like RB_RB_BAA_LowerJoint, with position limits -->
    <actuator>
        <motor joint="RB_MAA_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
        <motor joint="RB_MAA_FM_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
        <motor joint="RB_BAA_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
        <motor joint="RB_BAA_FM_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
        <motor joint="Leg_RB_BAA_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
        <motor joint="Leg_RB_BAA_FM_SlideJoint" ctrllimited="true" ctrlrange="-200 200" />
    </actuator>

    <!-- Establish parallel relationships, e.g., RB_RB_BAA_LOLink should connect to RB_Calf --> 
    <equality>
        <connect name="RB_BAA_connect" anchor="0 0 0" body2="RB_Calf" body1="RB_BAA_LOLink" solimp="0.95 0.99 0.00001 0.1 2"/>
        <connect name="RB_MAA_connect" anchor="0 0 0" body2="RB_Thigh" body1="RB_MAA_LOLink" solimp="0.95 0.99 0.00001 0.1 2"/>
        <connect name="Leg_RB_BAA_connect" anchor="0 0 0" body2="Leg" body1="Leg_RB_BAA_LOLink" solimp="0.95 0.99 0.00001 0.1 2"/>
        
        <!-- FM equality constraints -->
        <joint name="MAA" joint1="RB_MAA_SlideJoint" joint2="RB_MAA_FM_SlideJoint" solimp="0.95 0.99 0.00001 0.1 2"/>
        <joint name="BAA" joint1="RB_BAA_SlideJoint" joint2="RB_BAA_FM_SlideJoint" solimp="0.95 0.99 0.00001 0.1 2"/>
        <joint name="Leg_RB_BAA" joint1="Leg_RB_BAA_SlideJoint" joint2="Leg_RB_BAA_FM_SlideJoint" solimp="0.95 0.99 0.00001 0.1 2"/>
    </equality>

    <!-- visualization -->
    <tendon>
        <spatial stiffness="0" width="0.003">
            <site site="RB_MAA_anchor1"/>
            <site site="RB_MAA_anchor2"/>
        </spatial>
        <spatial stiffness="0" width="0.003">
            <site site="RB_BAA_anchor1"/>
            <site site="RB_BAA_anchor2"/>
        </spatial>
        <spatial stiffness="0" width="0.003">
            <site site="Leg_RB_BAA_anchor1"/>
            <site site="Leg_RB_BAA_anchor2"/>
        </spatial>
    </tendon>

</mujoco>